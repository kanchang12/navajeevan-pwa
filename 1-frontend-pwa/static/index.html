<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NavaJeevan Triage AI</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 600px; margin: 0 auto; }
        
        .disclaimer {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 3px solid #c92a2a;
            text-align: center;
        }
        
        .disclaimer h2 { margin-bottom: 10px; font-size: 18px; }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 { color: #1a73e8; margin-bottom: 5px; }
        
        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .tab-btn.active { background: #1a73e8; color: white; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .form-group { margin-bottom: 15px; }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus { outline: none; border-color: #1a73e8; }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn-primary { background: #1a73e8; color: white; }
        .btn-voice { background: #4CAF50; color: white; }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.show { display: block; }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result {
            display: none;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result.show { display: block; }
        .result.healthy { background: #d4edda; border: 2px solid #28a745; }
        .result.at-risk { background: #fff3cd; border: 2px solid #ffc107; }
        .result.critical { background: #f8d7da; border: 2px solid #dc3545; }
        
        .error {
            display: none;
            background: #f8d7da;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .error.show { display: block; }
        
        .image-upload {
            border: 2px dashed #ddd;
            padding: 40px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .image-preview img {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="disclaimer">
            <h2>‚ö†Ô∏è HACKATHON PROTOTYPE ONLY ‚ö†Ô∏è</h2>
            <p><strong>Government and Legal approval required before real-world implementation.</strong></p>
        </div>

        <div class="header">
            <h1>üë∂ NavaJeevan Triage AI</h1>
            <p>AI-Powered Newborn Health Assessment</p>
        </div>

        <div class="card">
            <h3>Baby Tracking</h3>
            <select id="babySelect">
                <option value="">-- New Baby --</option>
            </select>
        </div>

        <div class="card">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('form')">üìù Form</button>
                <button class="tab-btn" onclick="switchTab('voice')">üéôÔ∏è Voice</button>
                <button class="tab-btn" onclick="switchTab('image')">üì∏ Image</button>
            </div>

            <div id="form-tab" class="tab-content active">
                <h3>Enter Newborn Vitals</h3>
                <form id="assessmentForm">
                    <div class="form-group">
                        <label>Baby Name</label>
                        <input type="text" id="baby_name" required>
                    </div>
                    <div class="form-group">
                        <label>Age (days)</label>
                        <input type="number" id="age_days" min="1" max="30" required>
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="weight_kg" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label>Temperature (¬∞C)</label>
                        <input type="number" id="temperature_c" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label>Respiratory Rate (bpm)</label>
                        <input type="number" id="respiratory_rate_bpm" required>
                    </div>
                    <div class="form-group">
                        <label>Oxygen Saturation (%)</label>
                        <input type="number" id="oxygen_saturation" required>
                    </div>
                    <div class="form-group">
                        <label>Feeding Frequency (per day)</label>
                        <input type="number" id="feeding_frequency_per_day" required>
                    </div>
                    <div class="form-group">
                        <label>Urine Output (count/day)</label>
                        <input type="number" id="urine_output_count" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Assess Risk</button>
                </form>
            </div>

            <div id="voice-tab" class="tab-content">
                <h3>Voice Input</h3>
                <p>Feature coming soon - speak vitals in your language</p>
                <button class="btn btn-voice">üéôÔ∏è Start Recording</button>
            </div>

            <div id="image-tab" class="tab-content">
                <h3>Image Analysis</h3>
                <div class="image-upload">
                    <input type="file" id="imageInput" accept="image/*" style="display:none">
                    <label for="imageInput">üì∏ Take/Upload Photo</label>
                </div>
                <div id="imagePreview"></div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing...</p>
            </div>

            <div class="error" id="error"></div>
            <div class="result" id="result"></div>
        </div>

        <div class="footer">
            <p>Built for Cloud Run Hackathon | Powered by Gemini AI</p>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THIS WITH YOUR TRIAGE API URL
        const API_URL = 'https://navajeevan-triage-api-451954006366.us-central1.run.app/predict';
        
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }
        
        // Baby tracking
        function loadBabies() {
            const babies = JSON.parse(localStorage.getItem('babies') || '[]');
            const select = document.getElementById('babySelect');
            select.innerHTML = '<option value="">-- New Baby --</option>';
            babies.forEach(baby => {
                select.innerHTML += `<option value="${baby.id}">${baby.name}</option>`;
            });
        }
        
        function saveBaby(name, data) {
            const babies = JSON.parse(localStorage.getItem('babies') || '[]');
            const babyId = Date.now().toString();
            babies.push({ id: babyId, name, assessments: [data] });
            localStorage.setItem('babies', JSON.stringify(babies));
            loadBabies();
        }
        
        // Form submission
        document.getElementById('assessmentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                age_days: parseInt(document.getElementById('age_days').value),
                weight_kg: parseFloat(document.getElementById('weight_kg').value),
                temperature_c: parseFloat(document.getElementById('temperature_c').value),
                respiratory_rate_bpm: parseInt(document.getElementById('respiratory_rate_bpm').value),
                oxygen_saturation: parseInt(document.getElementById('oxygen_saturation').value),
                feeding_frequency_per_day: parseInt(document.getElementById('feeding_frequency_per_day').value),
                urine_output_count: parseInt(document.getElementById('urine_output_count').value)
            };
            
            const babyName = document.getElementById('baby_name').value;
            
            document.getElementById('loading').classList.add('show');
            document.getElementById('error').classList.remove('show');
            document.getElementById('result').classList.remove('show');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    displayResult(result);
                    saveBaby(babyName, { ...data, result, timestamp: new Date().toISOString() });
                } else {
                    throw new Error(result.message || 'Prediction failed');
                }
            } catch (err) {
                document.getElementById('error').textContent = `Error: ${err.message}`;
                document.getElementById('error').classList.add('show');
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        });
        
        function displayResult(data) {
            const result = document.getElementById('result');
            const prediction = data.prediction;
            const riskLevel = prediction.risk_level;
            
            result.className = 'result show';
            if (riskLevel === 'Healthy') result.classList.add('healthy');
            else if (riskLevel === 'At Risk') result.classList.add('at-risk');
            else if (riskLevel === 'Critical') result.classList.add('critical');
            
            const confidence = (prediction.confidence * 100).toFixed(1);
            
            result.innerHTML = `
                <h3>${getRiskIcon(riskLevel)} Risk Level: ${riskLevel}</h3>
                <p><strong>Confidence:</strong> ${confidence}%</p>
                <p><strong>Recommendation:</strong> ${data.recommendation}</p>
                ${data.explanation ? `<p><strong>Explanation:</strong> ${data.explanation}</p>` : ''}
            `;
        }
        
        function getRiskIcon(level) {
            if (level === 'Healthy') return '‚úÖ';
            if (level === 'At Risk') return '‚ö†Ô∏è';
            if (level === 'Critical') return 'üö®';
            return '';
        }
        
        // Initialize
        loadBabies();
        
        // Image upload preview
        document.getElementById('imageInput')?.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').innerHTML = 
                        `<img src="${e.target.result}" alt="Baby photo">`;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
